{
	"info": {
		"_postman_id": "8ee526df-0fba-4880-a0d5-e978b00a9797",
		"name": "mod-gobi",
		"description": "Tests for mod-gobi",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Test Setup",
			"item": [
				{
					"name": "/authn/login (OKAPI)",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7ae86997-5a37-4acf-9c37-1a431c0c75da",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"let tenant = pm.environment.get(\"xokapitenant\");",
									"let token = postman.getResponseHeader(\"x-okapi-token\");",
									"pm.globals.set(\"xokapitoken\", token);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "d75a59b9-367d-4055-86c6-0b6c1cf9b86c",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"username\":\"{{username}}\",\"password\":\"{{password}}\"}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"authn",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "/vendor",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "bf46482a-5904-4297-a271-fa22d682771c",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Vendor was created. Status is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.globals.set(\"vendor\", pm.response.json());"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"GOBI Library Systems\",\n  \"code\": \"GOBI\"\n}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/vendor",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"vendor"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Positive Tests",
			"item": [
				{
					"name": "/validate",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c6566d89-e8ea-4fca-a388-d40938eb27f0",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 204\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "apiKey SHAzQkdpVndqR19mczAwMDAwMDAwX2ZzMDAwMDAwMDA",
								"disabled": true
							}
						],
						"body": {},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/gobi/validate",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"gobi",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "/order - ListedElectronicMonograph",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "969f0328-aa57-43a4-9bb9-ba008d15e635",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"    pm.expect(postman.getResponseHeader(\"Content-Type\")).to.equal(\"application/xml\")",
									"});",
									"",
									"",
									"pm.test(\"A PO number is returned in the response\", function(){",
									"    pm.expect(pm.response.text()).to.include(\"PoLineNumber\")",
									"})"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/xml"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<PurchaseOrder>\n  <CustomerDetail>\n    <BaseAccount>5095</BaseAccount>\n    <SubAccount>509596</SubAccount>\n  </CustomerDetail>\n  <Order>\n    <ListedElectronicMonograph>\n      <collection>\n        <record>\n          <leader>00585nam  22001813  4500</leader>\n          <controlfield tag=\"001\"></controlfield>\n          <controlfield tag=\"003\">NhCcYBP</controlfield>\n          <controlfield tag=\"005\">20150813163447.0</controlfield>\n          <controlfield tag=\"006\">m||||||||d||||||||</controlfield>\n          <controlfield tag=\"007\">cr||||||||||||</controlfield>\n          <controlfield tag=\"008\">150813q2012    xx |||||o|||||||| | eng d</controlfield>\n          <datafield tag=\"020\" ind1=\" \" ind2=\" \">\n            <subfield code=\"a\">9780817913465 (electronic bk.)</subfield>\n          </datafield>\n          <datafield tag=\"035\" ind1=\" \" ind2=\" \">\n            <subfield code=\"a\">(OCoLC)808344423</subfield>\n          </datafield>\n          <datafield tag=\"040\" ind1=\" \" ind2=\" \">\n            <subfield code=\"a\">NhCcYBP</subfield>\n            <subfield code=\"c\">NhCcYBP</subfield>\n          </datafield>\n          <datafield tag=\"100\" ind1=\" \" ind2=\" \">\n            <subfield code=\"a\">ANDERSON, KENNETH, 1956-</subfield>\n          </datafield>\n          <datafield tag=\"245\" ind1=\"0\" ind2=\"0\">\n            <subfield code=\"a\">LIVING WITH THE UN</subfield>\n            <subfield code=\"h\">[electronic resource] :</subfield>\n            <subfield code=\"b\">AMERICAN RESPONSIBILITIES AND INTERNATIONAL ORDER.</subfield>\n          </datafield>\n          <datafield tag=\"260\" ind1=\" \" ind2=\" \">\n            <subfield code=\"a\">STANFORD :</subfield>\n            <subfield code=\"b\">HOOVER INSTITUTION PRESS,</subfield>\n            <subfield code=\"c\">2012.</subfield>\n          </datafield>\n          <datafield tag=\"490\" ind1=\"0\" ind2=\" \">\n            <subfield code=\"a\">HOOVER INSTITUTION PRESS PUBLICATION.</subfield>\n            <subfield code=\"v\">609</subfield>\n          </datafield>\n        </record>\n      </collection>\n      <OrderDetail>\n        <BatchPONumber />\n        <ItemPONumber>.o22310460</ItemPONumber>\n        <FundCode>xnath</FundCode>\n        <MappedFundCode />\n        <OrderNotes />\n        <OtherLocalId>.o22310460</OtherLocalId>\n        <Location>NATH</Location>\n        <Quantity>1</Quantity>\n        <YBPOrderKey>99952919209</YBPOrderKey>\n        <OrderPlaced>2013-03-20T14:35:35</OrderPlaced>\n        <ListPrice>\n          <Amount>14.95</Amount>\n          <Currency>USD</Currency>\n        </ListPrice>\n        <PurchaseOption>\n          <VendorPOCode>EBRSU</VendorPOCode>\n          <Code>SU</Code>\n          <Description>Gobi</Description>\n          <VendorCode>GOBI</VendorCode>\n        </PurchaseOption>\n      </OrderDetail>\n    </ListedElectronicMonograph>\n  </Order>\n</PurchaseOrder>"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/gobi/orders",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"gobi",
								"orders"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Negative Tests",
			"item": [
				{
					"name": "/validate - user with no permission",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "cfecec07-a5bd-4016-892a-839851275005",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Passing in a token that's associated with a user who doesn't have permission\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-okapi-token",
								"value": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXJfaWQiOiJlZjY3NmRiOS1kMjMxLTQ3OWEtYmI5MS1mNjVlYjRiMTc4NzIiLCJ0ZW5hbnQiOiJmczAwMDAwMDAwIiwiaWF0IjoxNTM2NzI1MTc1fQ.RphE1xHdEctiZU1AFHT2SFPXz-tWO129V_2L1DCmQ1sMxkVQLBkvy8B3hBzDaLbOpfqwTEW4vHPBSJ28WNeopA"
							},
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/gobi/validate",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"gobi",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "/validate - with no Okapi token",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "fbb18ac2-ef0d-4155-b224-f05522eab603",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Calling gobi/validate without a token\", function () {",
									"    pm.response.to.have.status(403);",
									"    pm.expect(pm.response.text()).to.equal(\"Access requires permission: gobi.item.post\")",
									"});",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/gobi/validate",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"gobi",
								"validate"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Cleanup",
			"item": [
				{
					"name": "/vendor/id",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "ffb3bd27-ba00-40e0-90ac-7a1558cf2552",
								"type": "text/javascript",
								"exec": [
									"pm.globals.set(\"vendorId\", pm.globals.get(\"vendor\").id);"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "3d4319f2-d27b-4c84-b26e-d6480ed7e508",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"DELETE /vendor/<vendorId> returns 204 status\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "x-okapi-tenant",
								"value": "{{xokapitenant}}"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/vendor/{{vendorId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"vendor",
								"{{vendorId}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "29271af0-d608-4fd0-a6d0-7f47697b19ba",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "65f7e387-a850-4a74-a499-63606dd653fa",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "c131b70b-8772-48fb-9726-3741fecc4b92",
			"key": "testdataBaseURL",
			"value": "https://raw.githubusercontent.com/folio-org/mod-gobi/master/src/test/resources/GOBIIntegrationServiceResourceImpl/",
			"type": "string"
		}
	]
}